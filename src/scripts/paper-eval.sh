# === 1. Main Results ===

# 1.1 T0-heldin

# Routing-stats
CUDA_VISIBLE_DEVICES=0 python inference-routing-stats.py -c t5xl.json -k moe_inference=True dataset=p3socialiqa,p3commongen,p3paws eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=100 project_name=paper-results name=testset/t0/heldin/top_2-scale_100 moe_top_k=2
CUDA_VISIBLE_DEVICES=0 python inference-routing-stats.py -c t5xl.json -k moe_inference=True dataset=p3socialiqa,p3commongen,p3paws eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' project_name=paper-results name=testset/t0/heldin/phatgoose moe_top_k=2

# LoRAHub
CUDA_VISIBLE_DEVICES=0 python inference.py -c t5xl.json -k moe_inference=False lora_hub_eval=True dataset=t0-heldin eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' project_name=paper-results name=testset/t0/heldin/lorahub
# Arrow
CUDA_VISIBLE_DEVICES=1 python inference.py -c t5xl.json -k moe_inference=True arrow_routing=True dataset=t0-heldin eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints-arrow' project_name=paper-results name=testset/t0/heldin/arrow

# 1.2 T0-heldout

# Routing-stats
CUDA_VISIBLE_DEVICES=1 python inference-routing-stats.py -c t5xl.json -k moe_inference=True dataset=p3copa,p3storycloze,p3wscfixed eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=1000 project_name=paper-results name=testset/t0/heldout/top_2-scale_1000 moe_top_k=2
CUDA_VISIBLE_DEVICES=2 python inference-routing-stats.py -c t5xl.json -k moe_inference=True dataset=p3copa,p3storycloze,p3wscfixed eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' project_name=paper-results name=testset/t0/heldout/phatgoose moe_top_k=2

# LoRAHub
CUDA_VISIBLE_DEVICES=1 python inference.py -c t5xl.json -k moe_inference=False lora_hub_eval=True dataset=t0-heldout eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' project_name=paper-results name=testset/t0/heldout/lorahub

# 1.3 T0-BBH

CUDA_VISIBLE_DEVICES=5 python inference.py -c t5xl.json -k moe_inference=True dataset=bbbbqlitejson,bbstrangestories eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench-v2/nomic_instruction_embedding.pt' bias_routing_scale=100 project_name=paper-results name=testset/t0/bb-debug/top_2-scale_100

# LoRAHub
CUDA_VISIBLE_DEVICES=2 python inference.py -c t5xl.json -k moe_inference=False lora_hub_eval=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' project_name=paper-results name=testset/t0/bbh/lorahub

# 1.4 T0-BBL

# LoRAHub
CUDA_VISIBLE_DEVICES=3 python inference.py -c t5xl.json -k moe_inference=False lora_hub_eval=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' project_name=paper-results name=testset/t0/bbl/lorahub


CUDA_VISIBLE_DEVICES=1 python inference.py -c t5xl.json -k moe_inference=True arrow_routing=True dataset=bbhinduknowledge eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints-arrow' project_name=paper-results name=testset/t0/bbl-debug/arrow


# 1.5 FLAN-BBH
MM_ROOT=`pwd` CUDA_VISIBLE_DEVICES=6 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=full checkpoint_dir_or_path='saved_runs/full-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/flan-v2/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/flan/bbh/top_2-scale_3

# LoRAHub
MM_ROOT=`pwd` CUDA_VISIBLE_DEVICES=4 python inference.py -c t5xl.json -k moe_inference=False lora_hub_eval=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=full checkpoint_dir_or_path='saved_runs/full-lora-checkpoints' project_name=paper-results name=testset/flan/bbh/lorahub


# 1.6 FLAN-BBL
MM_ROOT=`pwd` CUDA_VISIBLE_DEVICES=7 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=full checkpoint_dir_or_path='saved_runs/full-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/flan-v2/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/flan/bbl/top_2-scale_3

# LoRAHub
MM_ROOT=`pwd` CUDA_VISIBLE_DEVICES=5 python inference.py -c t5xl.json -k moe_inference=False lora_hub_eval=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=full checkpoint_dir_or_path='saved_runs/full-lora-checkpoints' project_name=paper-results name=testset/flan/bbl/lorahub

# === 2. Ablation study on top-k routing ===

# 2.1 T0-heldin
CUDA_VISIBLE_DEVICES=0 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldin eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=100 project_name=paper-results name=testset/t0/heldin/top_1-scale_100 moe_top_k=1
CUDA_VISIBLE_DEVICES=1 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldin eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=100 project_name=paper-results name=testset/t0/heldin/top_3-scale_100 moe_top_k=3

CUDA_VISIBLE_DEVICES=2 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldin eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=100 project_name=paper-results name=testset/t0/heldin/top_0.25-scale_100 moe_top_p=0.25
CUDA_VISIBLE_DEVICES=3 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldin eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=100 project_name=paper-results name=testset/t0/heldin/top_0.5-scale_100 moe_top_p=0.5
CUDA_VISIBLE_DEVICES=4 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldin eval_split=test val_fraction=0.2 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=100 project_name=paper-results name=testset/t0/heldin/top_0.75-scale_100 moe_top_p=0.75


# 2.2 T0-heldout
CUDA_VISIBLE_DEVICES=2 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldout eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/heldout/top_1-scale_3 moe_top_k=1
CUDA_VISIBLE_DEVICES=3 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldout eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/heldout/top_3-scale_3 moe_top_k=3

CUDA_VISIBLE_DEVICES=4 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldout eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/heldout/top_0.25-scale_3 moe_top_p=0.25
CUDA_VISIBLE_DEVICES=5 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldout eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/heldout/top_0.5-scale_3 moe_top_p=0.5
CUDA_VISIBLE_DEVICES=6 python inference.py -c t5xl.json -k moe_inference=True dataset=t0-heldout eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v4/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/heldout/top_0.75-scale_3 moe_top_p=0.75


# 2.3 T0-BBH
CUDA_VISIBLE_DEVICES=0 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbh/top_1-scale_3 moe_top_k=1
CUDA_VISIBLE_DEVICES=1 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbh/top_3-scale_3 moe_top_k=3

CUDA_VISIBLE_DEVICES=4 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbh/top_0.25-scale_3 moe_top_p=0.25
CUDA_VISIBLE_DEVICES=5 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbh/top_0.5-scale_3 moe_top_p=0.5
CUDA_VISIBLE_DEVICES=7 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-hard eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbh/top_0.75-scale_3 moe_top_p=0.75


# 2.4 T0-BBL
CUDA_VISIBLE_DEVICES=2 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbl/top_1-scale_3 moe_top_k=1
CUDA_VISIBLE_DEVICES=3 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbl/top_3-scale_3 moe_top_k=3

CUDA_VISIBLE_DEVICES=4 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbl/top_0.25-scale_3 moe_top_p=0.25
CUDA_VISIBLE_DEVICES=5 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbl/top_0.5-scale_3 moe_top_p=0.5
CUDA_VISIBLE_DEVICES=6 python inference.py -c t5xl.json -k moe_inference=True dataset=bigbench-lite eval_split=test val_fraction=0 init_datasets=t0-heldin checkpoint_dir_or_path='saved_runs/p3-lora-checkpoints' bias_router_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/t0-v3/checkpoints/nomic_instruction_embedding.pt' bias_input_embedding_path='saved_runs/gpt-generated-instruction-nomic-embeddings/bigbench/checkpoints/nomic_instruction_embedding.pt' bias_routing_scale=3 project_name=paper-results name=testset/t0/bbl/top_0.75-scale_3 moe_top_p=0.75